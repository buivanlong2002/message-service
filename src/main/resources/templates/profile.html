<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Thông tin cá nhân</title>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h2>Trang cá nhân</h2>

<div id="userInfo">
    <p><strong>Họ tên:</strong> <span id="name"></span></p>
    <p><strong>Email:</strong> <span id="email"></span></p>
    <p><strong>ID:</strong> <span id="id"></span></p>
</div>

<div id="message" style="color:red; margin-top: 1rem;"></div>

<button id="logoutBtn">Đăng xuất</button>

<script>
    $(document).ready(function () {
        const token = localStorage.getItem('access_token');

        if (!token) {
            $('#message').text("Bạn chưa đăng nhập.");
            return;
        }

        // Giải mã token để lấy userId (nếu backend yêu cầu truyền ID)
        const payload = JSON.parse(atob(token.split('.')[1]));
        const userId = payload.id;

        $.ajax({
            url: `/api/auth/${userId}`,
            type: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function (response) {
                if (response.status.code === "00" && response.status.success) {
                    const user = response.data;
                    $('#name').text(user.name || user.username);
                    $('#email').text(user.email);
                    $('#id').text(user.id);
                } else {
                    $('#message').text("Không lấy được thông tin người dùng.");
                }
            },
            error: function (xhr) {
                $('#message').text("Lỗi khi lấy thông tin: " + (xhr.responseJSON?.status?.displayMessage || "Không rõ lỗi"));
            }
        });

        // Đăng xuất: xóa token và về login
        $('#logoutBtn').click(function () {
            localStorage.removeItem('access_token');
            window.location.href = '/login';
        });
    });
</script>
</body>
</html>
